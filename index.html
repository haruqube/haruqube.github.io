<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Birthday üéÇ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Noto+Serif+JP:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #e8b923;
            --gold-light: #ffd54f;
            --pink: #ff6b9d;
            --pink-dark: #e91e63;
            --pink-light: #ffc1d3;
            --cream: #fffef8;
            --purple: #9c27b0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            height: 100dvh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0c29 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-family: 'Noto Serif JP', serif;
            perspective: 1200px;
        }

        .stars {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
            will-change: opacity;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .floating-hearts {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        .floating-heart {
            position: absolute;
            bottom: -50px;
            font-size: 20px;
            opacity: 0;
            animation: floatUp 10s ease-in-out infinite;
            will-change: transform, opacity;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100vh); opacity: 0; }
        }

        .scene {
            position: relative;
            width: 300px;
            height: 200px;
            transform-style: preserve-3d;
            z-index: 10;
            cursor: pointer;
        }

        .hint {
            position: absolute;
            top: -70px;
            width: 100%;
            text-align: center;
            color: var(--pink-light);
            font-size: 1rem;
            letter-spacing: 0.1em;
            animation: bounce 2s ease-in-out infinite;
            text-shadow: 0 0 10px rgba(255,107,157,0.5);
            transition: opacity 0.3s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .scene.opened .hint { opacity: 0; }

        .card {
            position: absolute;
            width: 280px;
            height: 380px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, var(--cream) 0%, #fff5f8 100%);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            border: 3px solid var(--pink-light);
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
            transition: transform 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s;
            will-change: transform, opacity;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 2px solid var(--pink);
            border-radius: 8px;
            opacity: 0.2;
            pointer-events: none;
        }

        .card-deco {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0.6;
        }
        .card-deco.top-left { top: 15px; left: 15px; }
        .card-deco.top-right { top: 15px; right: 15px; }
        .card-deco.bottom-left { bottom: 15px; left: 15px; }
        .card-deco.bottom-right { bottom: 15px; right: 15px; }

        .card-1 { z-index: 5; }
        .scene.opened .card-1 {
            opacity: 1;
            transform: translate(-50%, -50%) translateY(-100px);
            z-index: 60;
            pointer-events: auto;
        }
        .scene.opened.show-card2 .card-1 {
            transform: translate(-50%, -50%) translateY(-100px) translateX(-150%) rotateY(-15deg);
            opacity: 0.6;
            z-index: 59;
        }

        .card-2 {
            z-index: 4;
            background: linear-gradient(180deg, #fff8f0 0%, #fff5f8 100%);
        }
        .scene.opened .card-2 {
            opacity: 0;
            transform: translate(-50%, -50%) translateY(-100px) translateX(50%) scale(0.9);
            pointer-events: none;
        }
        .scene.opened.show-card2 .card-2 {
            opacity: 1;
            transform: translate(-50%, -50%) translateY(-100px);
            z-index: 61;
            pointer-events: auto;
        }

        .card h1 {
            font-family: 'Great Vibes', cursive;
            font-size: 2.4rem;
            background: linear-gradient(135deg, var(--pink-dark), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            opacity: 0;
            transform: translateY(20px);
        }
        .scene.opened .card-1 h1 {
            animation: slideIn 0.8s ease forwards 0.5s;
        }
        @keyframes slideIn {
            to { opacity: 1; transform: translateY(0); }
        }

        .card-icon {
            font-size: 2rem;
            margin: 5px 0 10px;
            opacity: 0;
            transform: scale(0);
        }
        .scene.opened .card-1 .card-icon {
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards 0.8s;
        }
        @keyframes popIn {
            to { opacity: 1; transform: scale(1); }
        }

        .typing-area {
            min-height: 160px;
            margin: 5px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .typing-text {
            font-size: 1.05rem;
            line-height: 2.2;
            color: #555;
            white-space: pre-wrap;
        }

        .cursor {
            display: inline-block;
            width: 2px;
            height: 1em;
            background: var(--pink);
            margin-left: 1px;
            vertical-align: baseline;
            position: relative;
            top: 0.15em;
            animation: blink 0.6s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        .card-2 .card-icon { opacity: 0; transform: scale(0); }
        .scene.opened.show-card2 .card-2 .card-icon {
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards 0.3s;
        }

        .card-2 .message-text {
            font-size: 1.1rem;
            line-height: 2.4;
            color: #555;
            white-space: pre-wrap;
            opacity: 0;
            transform: translateY(20px);
        }
        .scene.opened.show-card2 .card-2 .message-text {
            animation: fadeInUp 0.8s ease forwards 0.5s;
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        .card-footer {
            margin-top: 10px;
            font-family: 'Great Vibes', cursive;
            font-size: 1.5rem;
            color: var(--gold);
            opacity: 0;
            text-shadow: 0 0 10px rgba(232,185,35,0.3);
        }
        .scene.opened.show-card2 .card-2 .card-footer {
            animation: fadeInUp 0.8s ease forwards 0.9s;
        }

        .envelope-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease 0.3s;
            z-index: 20;
        }
        .scene.opened .envelope-wrapper {
            opacity: 0;
            z-index: 1;
            pointer-events: none;
        }

        .envelope {
            position: absolute;
            inset: 0;
            filter: drop-shadow(0 15px 30px rgba(0,0,0,0.4));
        }

        .envelope-body {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #ff6b9d 0%, #e91e63 100%);
            border-radius: 10px;
        }

        .flap {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            transform-origin: top center;
            transform-style: preserve-3d;
            transition: transform 0.7s ease-in-out;
            z-index: 3;
        }
        .flap-svg, .flap-back-svg {
            position: absolute;
            width: 100%; height: 100%;
            backface-visibility: hidden;
        }
        .flap-back-svg { transform: rotateX(180deg); }
        .scene.opened .flap { transform: rotateX(-180deg); }

        .seal {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 55px; height: 55px;
            background: radial-gradient(circle at 30% 30%, var(--gold-light), var(--gold), #f9a825);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 20px rgba(232,185,35,0.4);
            transition: all 0.5s;
        }
        .scene.opened .seal {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0) rotate(180deg);
        }

        .reset-btn {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 30px;
            background: rgba(255,255,255,0.1);
            border: 2px solid var(--pink);
            color: var(--pink-light);
            border-radius: 30px;
            font-size: 0.9rem;
            font-family: 'Noto Serif JP', serif;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s;
            backdrop-filter: blur(10px);
            z-index: 200;
        }
        .scene.opened ~ .reset-btn {
            opacity: 1;
            visibility: visible;
            transition-delay: 3s;
        }
        .reset-btn:active {
            transform: translateX(-50%) scale(0.95);
            background: rgba(255,255,255,0.2);
        }

        .album-btn {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 30px;
            background: linear-gradient(90deg, #ff6b9d, #e91e63);
            border: none;
            color: white;
            border-radius: 30px;
            font-size: 0.9rem;
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 700;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s;
            box-shadow: 0 4px 20px rgba(233, 30, 99, 0.4);
            z-index: 200;
        }
        .scene.opened ~ .album-btn {
            opacity: 1;
            visibility: visible;
            transition-delay: 3.5s;
        }
        .album-btn:active {
            transform: translateX(-50%) scale(0.95);
        }

        canvas {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 100;
        }

        .emoji-burst {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            font-size: 32px;
            will-change: transform, opacity;
        }

        .petal {
            position: fixed;
            pointer-events: none;
            z-index: 999;
            will-change: transform, opacity;
        }

        .light-particle {
            position: fixed;
            pointer-events: none;
            z-index: 1001;
            border-radius: 50%;
            will-change: transform, opacity;
        }

        .sparkle {
            position: fixed;
            pointer-events: none;
            z-index: 500;
            font-size: 24px;
            animation: sparkleFade 0.8s forwards;
        }
        @keyframes sparkleFade {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
    </style>
</head>
<body>

<div class="stars" id="stars"></div>
<div class="floating-hearts" id="floating-hearts"></div>
<canvas id="canvas"></canvas>

<div class="scene" id="scene">
    <div class="hint">‚ú® „Çø„ÉÉ„Éó„Åó„Å¶Èñã„Åë„Å¶„Å≠ ‚ú®</div>

    <div class="card card-1" id="card-1">
        <span class="card-deco top-left">üéÄ</span>
        <span class="card-deco top-right">üéÄ</span>
        <span class="card-deco bottom-left">‚ú®</span>
        <span class="card-deco bottom-right">‚ú®</span>
        <h1>Happy Birthday</h1>
        <div class="card-icon">üéÇ</div>
        <div class="typing-area">
            <span id="typing-text-1" class="typing-text"></span><span id="cursor-1" class="cursor" style="display:none;"></span>
        </div>
    </div>

    <div class="card card-2" id="card-2">
        <span class="card-deco top-left">üíñ</span>
        <span class="card-deco top-right">üíñ</span>
        <span class="card-deco bottom-left">üå∏</span>
        <span class="card-deco bottom-right">üå∏</span>
        <div class="card-icon">üíù</div>
        <div class="typing-area">
            <p class="message-text">„ÇÅ„Å£„Å°„ÇÉÊÑõ„Åó„Å¶„Çã„Åú<br>„ÅØ„Çã„Åü„Åã</p>
        </div>
        <div class="card-footer">With Love üíï</div>
    </div>

    <div class="envelope-wrapper">
        <div class="envelope">
            <div class="envelope-body"></div>
            <div class="flap">
                <svg class="flap-svg" viewBox="0 0 300 200" preserveAspectRatio="none">
                    <defs>
                        <linearGradient id="flapGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#f8a4c0"/>
                            <stop offset="100%" style="stop-color:#ff6b9d"/>
                        </linearGradient>
                    </defs>
                    <path d="M10,0 Q0,0 0,10 L0,15 L150,105 L300,15 L300,10 Q300,0 290,0 Z" fill="url(#flapGradient)"/>
                </svg>
                <svg class="flap-back-svg" viewBox="0 0 300 200" preserveAspectRatio="none">
                    <defs>
                        <linearGradient id="flapBackGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                            <stop offset="0%" style="stop-color:#880e4f"/>
                            <stop offset="100%" style="stop-color:#ad1457"/>
                        </linearGradient>
                    </defs>
                    <path d="M10,0 Q0,0 0,10 L0,15 L150,105 L300,15 L300,10 Q300,0 290,0 Z" fill="url(#flapBackGradient)"/>
                </svg>
            </div>
            <div class="seal">üéÄ</div>
        </div>
    </div>
</div>

<button class="reset-btn" id="reset-btn">üéÅ „ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë¶ã„Çã</button>
<a href="album.html" class="album-btn">üì∏ „Ç¢„É´„Éê„É†„ÇíË¶ã„Çã</a>

<script>
    const message1 = "ÊÑõ„Å°„ÇÉ„ÇìÔΩû\n„ÅäË™ïÁîüÊó•„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅüéâ\nÂπ∏„Åõ„Å™‰∏ÄÂπ¥„Å´„Å™„Çä„Åæ„Åô„Çà„ÅÜ„Å´";
    
    let isOpened = false;
    let canDoubleTap = false;
    let isTyping1 = false;
    let showingCard2 = false;
    let lastTapTime = 0;

    // Êòü„ÅÆÁîüÊàêÔºàÊï∞„ÇíÊ∏õ„Çâ„ÅôÔºâ
    function createStars() {
        const container = document.getElementById('stars');
        for (let i = 0; i < 30; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            const size = (Math.random() * 2 + 1) + 'px';
            star.style.width = size;
            star.style.height = size;
            container.appendChild(star);
        }
    }

    // ÊµÆÈÅä„Éè„Éº„ÉàÔºàÊï∞„ÇíÊ∏õ„Çâ„ÅôÔºâ
    function createFloatingHearts() {
        const container = document.getElementById('floating-hearts');
        const hearts = ['üíï', 'üíñ', 'üíó'];
        for (let i = 0; i < 8; i++) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.textContent = hearts[i % hearts.length];
            heart.style.left = Math.random() * 100 + '%';
            heart.style.animationDelay = Math.random() * 10 + 's';
            container.appendChild(heart);
        }
    }

    // ÂêåÂøÉÂÜÜ„ÅÆÁµµÊñáÂ≠ó„Éê„Éº„Çπ„ÉàÔºà‰øÆÊ≠£ÁâàÔºâ
    function createEmojiBurst(x, y) {
        const emojis = ['ü´∂', 'ü•∞', 'üíò', 'üíñ'];
        const rings = [
            { count: 8, delay: 0, startRadius: 20, maxRadius: 80 },
            { count: 10, delay: 150, startRadius: 30, maxRadius: 120 },
            { count: 12, delay: 300, startRadius: 40, maxRadius: 160 }
        ];
        
        rings.forEach(ring => {
            setTimeout(() => {
                for (let i = 0; i < ring.count; i++) {
                    const emoji = document.createElement('div');
                    emoji.className = 'emoji-burst';
                    emoji.textContent = emojis[i % emojis.length];
                    emoji.style.left = x + 'px';
                    emoji.style.top = y + 'px';
                    document.body.appendChild(emoji);
                    
                    const angle = (i / ring.count) * Math.PI * 2;
                    let radius = ring.startRadius;
                    let opacity = 0;
                    let scale = 0.5;
                    
                    function animate() {
                        // ÂÜÜ„ÅåÂ∫É„Åå„ÇãÔºàÊúÄÂ§ßÂçäÂæÑ„Åæ„ÅßÔºâ
                        if (radius < ring.maxRadius) {
                            radius += 3;
                        }
                        
                        // ÂÜÜÂë®‰∏ä„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
                        const px = Math.cos(angle) * radius;
                        const py = Math.sin(angle) * radius;
                        
                        // „Éï„Çß„Éº„Éâ„Ç§„É≥
                        if (radius < ring.maxRadius * 0.6 && opacity < 1) {
                            opacity += 0.15;
                        }
                        
                        // „Çπ„Ç±„Éº„É´
                        if (scale < 1) {
                            scale += 0.1;
                        }
                        
                        // „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
                        if (radius >= ring.maxRadius * 0.7) {
                            opacity -= 0.06;
                        }
                        
                        emoji.style.transform = `translate(-50%, -50%) translate(${px}px, ${py}px) scale(${scale})`;
                        emoji.style.opacity = Math.max(0, opacity);
                        
                        if (opacity > 0) {
                            requestAnimationFrame(animate);
                        } else {
                            emoji.remove();
                        }
                    }
                    animate();
                }
            }, ring.delay);
        });
    }

    // Ëä±„Å≥„ÇâÔºà‰øÆÊ≠£ÁâàÔºâ
    function createFallingPetals() {
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        const colors = ['#ffb7c5', '#ffc1cc', '#ffd1dc'];
        
        for (let i = 0; i < 15; i++) {
            setTimeout(() => {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.innerHTML = `<svg width="18" height="18" viewBox="0 0 20 20"><path d="M10 0 Q15 5 10 15 Q5 5 10 0" fill="${colors[i % 3]}" opacity="0.8"/></svg>`;
                
                let x = centerX + (Math.random() - 0.5) * 100;
                let y = centerY + (Math.random() - 0.5) * 100;
                let vx = (Math.random() - 0.5) * 3;
                let vy = -1 + Math.random();
                let rotation = Math.random() * 360;
                let opacity = 0;
                let scale = 0.3;
                let time = 0;
                
                petal.style.left = '0px';
                petal.style.top = '0px';
                document.body.appendChild(petal);
                
                function animate() {
                    time++;
                    if (opacity < 0.9) opacity += 0.05;
                    if (scale < 1) scale += 0.03;
                    
                    vx *= 0.99;
                    vy += 0.03;
                    x += vx + Math.sin(time * 0.05) * 0.5;
                    y += vy;
                    rotation += 2;
                    
                    if (y > window.innerHeight * 0.7) opacity -= 0.02;
                    
                    petal.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}deg) scale(${scale})`;
                    petal.style.opacity = opacity;
                    
                    if (opacity > 0 && y < window.innerHeight + 50) {
                        requestAnimationFrame(animate);
                    } else {
                        petal.remove();
                    }
                }
                animate();
            }, i * 60);
        }
    }

    // ÈáëËâ≤„Éë„Éº„ÉÜ„Ç£„ÇØ„É´Ôºà‰øÆÊ≠£ÁâàÔºâ
    function createGoldenParticles() {
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        const colors = ['#ffd700', '#ffecb3', '#ffe082'];
        
        for (let i = 0; i < 20; i++) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.className = 'light-particle';
                const size = 4 + Math.random() * 4;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                const color = colors[i % 3];
                particle.style.background = color;
                particle.style.boxShadow = `0 0 ${size}px ${color}`;
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                document.body.appendChild(particle);
                
                const angle = -Math.PI / 2 + (Math.random() - 0.5) * Math.PI * 0.8;
                const speed = 3 + Math.random() * 4;
                let vx = Math.cos(angle) * speed;
                let vy = Math.sin(angle) * speed;
                let x = 0;
                let y = 0;
                let opacity = 0;
                let scale = 0;
                
                function animate() {
                    if (opacity < 1) opacity += 0.08;
                    if (scale < 1) scale += 0.1;
                    
                    vx *= 0.98;
                    vy *= 0.98;
                    vy += 0.02;
                    x += vx;
                    y += vy;
                    
                    if (opacity >= 1) opacity -= 0.015;
                    
                    particle.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px) scale(${scale})`;
                    particle.style.opacity = opacity;
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        particle.remove();
                    }
                }
                animate();
            }, i * 30);
        }
    }

    // „É°„Ç§„É≥ÊºîÂá∫
    function celebrationEffect(x, y) {
        createEmojiBurst(x, y);
        setTimeout(() => createGoldenParticles(), 150);
        setTimeout(() => createFallingPetals(), 300);
    }

    // „Ç≠„É©„Ç≠„É©
    function createSparkle(x, y) {
        const sparkles = ['‚ú®', '‚≠ê'];
        for (let i = 0; i < 3; i++) {
            const el = document.createElement('div');
            el.className = 'sparkle';
            el.textContent = sparkles[i % 2];
            el.style.left = (x + (Math.random() - 0.5) * 80) + 'px';
            el.style.top = (y + (Math.random() - 0.5) * 80) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }
    }

    // 2ÊûöÁõÆ„Éè„Éº„ÉàÔºà‰øÆÊ≠£ÁâàÔºâ
    function createHeartEffect(x, y) {
        const hearts = ['üíñ', 'üíï', 'üíó', 'ü©∑', 'üíù'];
        for (let i = 0; i < 10; i++) {
            setTimeout(() => {
                const heart = document.createElement('div');
                heart.className = 'emoji-burst';
                heart.textContent = hearts[i % hearts.length];
                heart.style.fontSize = '26px';
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';
                document.body.appendChild(heart);
                
                const angle = (i / 10) * Math.PI * 2;
                const speed = 4 + Math.random() * 2;
                let vx = Math.cos(angle) * speed;
                let vy = Math.sin(angle) * speed;
                let px = 0, py = 0;
                let opacity = 1;
                let scale = 0;
                let frame = 0;
                
                function animate() {
                    frame++;
                    if (scale < 1) scale += 0.12;
                    vx *= 0.95;
                    vy *= 0.95;
                    px += vx;
                    py += vy;
                    if (frame > 20) opacity -= 0.04;
                    
                    heart.style.transform = `translate(-50%, -50%) translate(${px}px, ${py}px) scale(${scale})`;
                    heart.style.opacity = Math.max(0, opacity);
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        heart.remove();
                    }
                }
                animate();
            }, i * 40);
        }
    }

    // „Çø„Ç§„Éî„É≥„Ç∞
    function startTyping(targetId, cursorId, message, callback) {
        const target = document.getElementById(targetId);
        const cursor = document.getElementById(cursorId);
        cursor.style.display = 'inline-block';
        let i = 0;
        function type() {
            if (i < message.length) {
                target.textContent += message.charAt(i);
                i++;
                setTimeout(type, 100);
            } else {
                setTimeout(() => {
                    cursor.style.display = 'none';
                    if (callback) callback();
                }, 500);
            }
        }
        type();
    }

    // Á¥ôÂêπÈõ™ÔºàÊï∞„ÇíÊ∏õ„Çâ„ÅôÔºâ
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let confettiRunning = false;

    function startConfetti() {
        if (confettiRunning) return;
        confettiRunning = true;
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const colors = ['#ff6b9d', '#ffd54f', '#4fc3f7', '#ba68c8', '#81c784'];
        for (let i = 0; i < 50; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                size: Math.random() * 7 + 3,
                color: colors[Math.floor(Math.random() * colors.length)],
                speedY: Math.random() * 2 + 1.5,
                speedX: Math.random() * 1.5 - 0.75,
                rotation: Math.random() * 360,
                rotationSpeed: Math.random() * 4 - 2
            });
        }

        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.y += p.speedY;
                p.x += p.speedX;
                p.rotation += p.rotationSpeed;
                
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation * Math.PI / 180);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size * 0.6);
                ctx.restore();
                
                if (p.y > canvas.height + 20) {
                    p.y = -20;
                    p.x = Math.random() * canvas.width;
                }
            });
            requestAnimationFrame(update);
        }
        update();
    }

    function openEnvelope(e) {
        if (isOpened) return;
        isOpened = true;
        document.getElementById('scene').classList.add('opened');
        
        const x = e.clientX || window.innerWidth / 2;
        const y = e.clientY || window.innerHeight / 2;
        
        celebrationEffect(x, y);
        startConfetti();
        
        setTimeout(() => {
            if (!isTyping1) {
                isTyping1 = true;
                startTyping('typing-text-1', 'cursor-1', message1, () => { canDoubleTap = true; });
            }
        }, 1300);
    }

    function handleDoubleTap(e) {
        if (!canDoubleTap) return;
        const currentTime = Date.now();
        if (currentTime - lastTapTime < 300 && currentTime - lastTapTime > 0) {
            e.preventDefault();
            const scene = document.getElementById('scene');
            const x = e.clientX || window.innerWidth / 2;
            const y = e.clientY || window.innerHeight / 2;
            
            if (!showingCard2) {
                scene.classList.add('show-card2');
                showingCard2 = true;
                createSparkle(x, y);
                createHeartEffect(x, y);
            } else {
                scene.classList.remove('show-card2');
                showingCard2 = false;
                createSparkle(x, y);
            }
        }
        lastTapTime = currentTime;
    }

    function resetCard() {
        const scene = document.getElementById('scene');
        scene.classList.remove('opened', 'show-card2');
        document.getElementById('typing-text-1').textContent = '';
        document.getElementById('cursor-1').style.display = 'none';
        isOpened = false;
        isTyping1 = false;
        showingCard2 = false;
        canDoubleTap = false;
        lastTapTime = 0;
    }

    document.getElementById('scene').addEventListener('click', function(e) {
        if (!isOpened) openEnvelope(e);
        else handleDoubleTap(e);
    });

    document.getElementById('reset-btn').addEventListener('click', function(e) {
        e.stopPropagation();
        resetCard();
    });

    createStars();
    createFloatingHearts();
</script>
</body>
</html>
